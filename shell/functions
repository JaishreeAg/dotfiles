#
# Functions
#

_internal_error() {
  echo -e "${RED_FG}${BOLD}${@}${RESET}"
}

ssh-reagent () {
  ssh-add -l &> /dev/null && return 0
  for agent in /tmp/ssh-*/agent.*; do
    export SSH_AUTH_SOCK=$agent
    if ssh-add -l 2>&1 > /dev/null; then
      echo Found working SSH Agent:
      ssh-add -l
      return
    fi
  done
  _internal_error "Cannot find ssh agent - maybe you should reconnect and forward it?"
}

psgrep() {
  if [ -n "$1" ] ; then
    ps aux | grep $1 | grep -v grep
  else
    _internal_error "Need name to grep for"
  fi
}

pushdot() {
  [ -z "$1" ] && _internal_error "Need a commit message" && return 1
  pushd ~/.dotfiles
  git add .
  git commit -n -m "$*"
  git push origin master
  popd
}

watch-test() {
  [ -z "$1" ] && _internal_error "Need a target" && return 1
  fswatch -o -e "\.pyc" $@ | xargs -n1 -I{} make
}

type gcm >/dev/null && unalias gcm
# Allow git commit -m and auto-quote arguments
gcm () {
  nocorrect git commit -m "$*"
}

# Change to root with SSH agent etc
alias sus='sudo -HE -s'

rmbrokensym () {
  find . -maxdepth 1 -type l ! -exec test -e {} \; -delete
}
